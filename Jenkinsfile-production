node('jenkins-aws')
{

  stage('Checkout Repo')
  {
      checkout([$class: 'GitSCM',
      branches: [[name: '*/release/1.0.0']],
      doGenerateSubmoduleConfigurations: false,
      extensions: [],
      submoduleCfg: [],
      userRemoteConfigs: [[credentialsId: 'bitbucket',
      url: 'git@bitbucket.org:bridestory/bridestory-vendor-home.git']]])
  }
  stage('Build Image')
  {
    sh 'docker build -f Dockerfile.production -t 172405484086.dkr.ecr.ap-southeast-1.amazonaws.com/vendor-home:production-${BUILD_NUMBER} .'
  }

  stage('Container Testing')
  {
    sh 'bash container-testing-production.sh'
  }

  stage('Push Docker Image')
  {
    sh 'awsdockerlogin'
    sh 'docker push 172405484086.dkr.ecr.ap-southeast-1.amazonaws.com/vendor-home:production-${BUILD_NUMBER}'
  }


}